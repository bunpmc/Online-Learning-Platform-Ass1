@model CourseViewModel

@{
	ViewData["Title"] = Model.Title;
}

<div class="container-fluid">
	<div class="row">

		<!-- phải -->
		<div class="col-md-8 border-end" style="min-height: 100vh;">
			<h3 class="mt-3">@Model.Title</h3>

			@if (Model.CurrentLesson == null)
			{
				<p class="text-muted mt-4">
					Chọn một bài học ở bên phải để bắt đầu.
				</p>
			}
			else
			{
				<div class="lesson-content mt-4">

					@if (!string.IsNullOrEmpty(Model.CurrentLesson.VideoUrl))
					{
						<div class="mb-4">
							<video controls width="100%">
								<source src="@Model.CurrentLesson.VideoUrl" type="video/mp4" />
							</video>
						</div>
					}

					<h4>@Model.CurrentLesson.Title</h4>

					<div class="mt-3">
						@Html.Raw(Model.CurrentLesson.Content)
					</div>

					<div class="text-muted mt-4">
						Thời lượng: @Model.CurrentLesson.Duration phút
					</div>

					@if (!string.IsNullOrEmpty(Model.CurrentLesson.VideoUrl))
					{
						<div class="card mt-4">
							<div class="card-body">
								<h6>AI hỗ trợ bài học</h6>

								<button class="btn btn-sm btn-outline-primary mb-3"
										id="btn-summary"
										data-lesson-id="@Model.CurrentLesson.LessonId"
										@(Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Processing ? "disabled" : "")>
									Tóm tắt bằng AI
								</button>

								<div id="ai-summary" class="mb-3 text-muted">
									@if (Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Processing)
									{
										<span>Đợi xíu, AI đang tóm tắt bài này...</span>
									}
									else if (Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Done)
									{
										@Html.Raw(Model.CurrentLesson.AiSummary)
									}
								</div>

								<div class="input-group">
									<input type="text"
										   id="ai-question"
										   class="form-control"
										   placeholder="Hỏi AI về video này..." />
									<button class="btn btn-outline-secondary"
											id="btn-ask"
											data-lesson-id="@Model.CurrentLesson.LessonId">
										Hỏi
									</button>
								</div>

								<div id="ai-answer" class="mt-3"></div>
							</div>
						</div>
					}

				</div>
			}
		</div>

		<!-- trái -->
		<div class="col-md-4 bg-light" style="min-height: 100vh;">
			<h5 class="mt-3">Nội dung khóa học</h5>

			@foreach (var module in Model.Modules)
			{
				<div class="mt-3">
					<strong>@module.Title</strong>

					<ul class="list-group list-group-flush mt-2">
						@foreach (var lesson in module.Lessons)
						{
							<li class="list-group-item @(lesson.IsCurrent ? "active" : "")">
								<a class="text-decoration-none @(lesson.IsCurrent ? "text-white" : "")"
								   href="@Url.Action("Learn", "Course", new { courseId = Model.CourseId, lessonId = lesson.LessonId })">
									@lesson.Title
								</a>
							</li>
						}
					</ul>
				</div>
			}
		</div>

	</div>
</div>

@section Scripts {
	<script src="~/js/ai-lesson.js"></script>
}
